<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/style.css" />
    <title>Vite App</title>
  </head>
  <body>
    <!-- <div id="toolbarMenu">
      <button id="pdfInteractionsButton" onclick="togglePDFInteractions()">Activar Medici√≥n</button>
    </div> -->
    <canvas
      id="fabricCanvas"
      style="position: absolute; top: 0; left: 0"
    ></canvas>
    <iframe
      id="inlineFrameExample"
      title="Inline Frame Example"
      width="100%"
      height="100%"
      style="position: absolute; top: 0; left: 0; bottom: 0; right: 0"
      src="/pdfjs-4.10.38-dist/web/viewer.html?file=/public/SheetTemplate.pdf"
    >
    </iframe>
    <script src="/src/viewercode.js"></script>
    <script src="./public/fabric.min.js"></script>

    <script>
      const iframe = document.getElementById("inlineFrameExample");

      iframe.onload = () => {
        const iframeDoc =
          iframe.contentDocument || iframe.contentWindow.document;

          let canvasSizeValue = null;

        if (iframeDoc) {
          const observer = new MutationObserver(() => {
            const viewerElement = iframeDoc.getElementsByTagName("canvas");
            if (viewerElement.length > 0) {
              observer.disconnect();

              const copy = Array.from(viewerElement);

              copy.forEach((element) => {
                canvasSizeValue = element.getBoundingClientRect();
                configureFabric(element, canvasSizeValue);
              });
            }
          });
          observer.observe(iframeDoc.body, { childList: true, subtree: true });
        }
      };

      function configureFabric(pdfCanvas, canvasSize) {
        console.log("ESTE ES EL CANVAS SIZE: ", canvasSize);
        const fabricCanvas = document.createElement("canvas");
        document.body.appendChild(fabricCanvas);

        const fabricInstance = new fabric.Canvas(fabricCanvas, {
          isDrawingMode: true,
          width: canvasSize.width,
          height: canvasSize.height
        });

        fabricInstance.freeDrawingBrush.width = 2;
        fabricInstance.freeDrawingBrush.color = "blue";

        fabricInstance.wrapperEl.style.top = `${canvasSize.top}px`
        fabricInstance.wrapperEl.style.left = `${canvasSize.left}px`
      }
    </script>

    <!-- <div id="app"></div> -->
    <!-- <script type="module" src="/src/main.js"></script> -->
  </body>
</html>
